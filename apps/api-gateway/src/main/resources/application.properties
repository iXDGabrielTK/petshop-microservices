spring.application.name=api-gateway
server.port=8080

# --- Configuração do Redis ---
spring.data.redis.host=${SPRING_DATA_REDIS_HOST}
spring.data.redis.port=${SPRING_DATA_REDIS_PORT}

# --- JWT Config ---
jwt.public.key=${JWT_PUBLIC_KEY:}

# ==========================================
# ROTAS DE SERVIÇOS (BUSINESS)
# ==========================================

# ROTA 0: Auth Service
spring.cloud.gateway.routes[0].id=auth-service
spring.cloud.gateway.routes[0].uri=http://auth-service:8081
spring.cloud.gateway.routes[0].predicates[0]=Path=/usuarios/**, /oauth2/**
spring.cloud.gateway.routes[0].filters[0].name=RequestRateLimiter
spring.cloud.gateway.routes[0].filters[0].args.redis-rate-limiter.replenishRate=5
spring.cloud.gateway.routes[0].filters[0].args.redis-rate-limiter.burstCapacity=10
spring.cloud.gateway.routes[0].filters[0].args.key-resolver=#{@userKeyResolver}

# ROTA 1: Inventory Service
spring.cloud.gateway.routes[1].id=inv-service
spring.cloud.gateway.routes[1].uri=http://inv-service:8083
spring.cloud.gateway.routes[1].predicates[0]=Path=/produtos/**, /vendas/**, /movimentacoes/**

# Filtro de Proteção (10 requests por segundo, com explosão até 20)
spring.cloud.gateway.routes[1].filters[0].name=RequestRateLimiter
spring.cloud.gateway.routes[1].filters[0].args.redis-rate-limiter.replenishRate=10
spring.cloud.gateway.routes[1].filters[0].args.redis-rate-limiter.burstCapacity=20
spring.cloud.gateway.routes[1].filters[0].args.key-resolver=#{@userKeyResolver}

# ==========================================
# ROTAS INTERNAS PARA PUXAR O JSON (CORRIGIDO)
# ==========================================

# ROTA 2 (Era 3): Puxar JSON do Auth
spring.cloud.gateway.routes[2].id=auth-docs
spring.cloud.gateway.routes[2].uri=http://auth-service:8081
spring.cloud.gateway.routes[2].predicates[0]=Path=/v3/api-docs/auth
spring.cloud.gateway.routes[2].filters[0]=RewritePath=/v3/api-docs/auth, /v3/api-docs

# ROTA 3 (Era 4): Puxar JSON do Inventory
spring.cloud.gateway.routes[3].id=inv-docs
spring.cloud.gateway.routes[3].uri=http://inv-service:8083
spring.cloud.gateway.routes[3].predicates[0]=Path=/v3/api-docs/inventory
spring.cloud.gateway.routes[3].filters[0]=RewritePath=/v3/api-docs/inventory, /v3/api-docs

# ==========================================
# CONFIGURAÇÃO DO SWAGGER AGGREGATOR
# ==========================================

springdoc.api-docs.enabled=true
springdoc.swagger-ui.enabled=true
springdoc.swagger-ui.path=/swagger-ui.html

springdoc.swagger-ui.urls[0].name=Auth Service
springdoc.swagger-ui.urls[0].url=/v3/api-docs/auth

springdoc.swagger-ui.urls[1].name=Inventory Service
springdoc.swagger-ui.urls[1].url=/v3/api-docs/inventory

# --- Outras configs ---
management.endpoints.web.exposure.include=*
management.endpoint.health.show-details=always

cors.allowed-origins=${CORS_ALLOWED_ORIGINS}
cors.allowed-methods=${CORS_ALLOWED_METHODS}
cors.allowed-headers=${CORS_ALLOWED_HEADERS}
cors.allow-credentials=${CORS_ALLOW_CREDENTIALS}

spring.threads.virtual.enabled=true
logging.config=classpath:logback-shared.xml

server.compression.enabled=true
server.compression.mime-types=text/html,text/xml,text/plain,text/css,text/javascript,application/javascript,application/json
server.compression.min-response-size=1024